<!DOCTYPE html>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<html>	




<head>

    <title>FILMINDER</title>
    <meta charset = "UTF-8">
    <meta name = "FILMINDER" content = "Series Search Page for FILMINDER">
    <link rel="stylesheet" href="./style/style.css"/>
    
    
            
</head>

<html>
    <body>

        <section class = "TopBar">
        
            <button OnClick = "location.href = 'Website.html'">FILMINDER</button> 
    
            <button OnClick = "location.href = 'MovieSearchPage.html'"> Movie Search</button> 
            <button OnClick = "location.href = 'SeriesSearchPage.html'"> Series Search</button> 
            <button OnClick = "location.href = 'ActorSearchPage.html'"> Actors Search</button>
            <button OnClick = "location.href = 'UserSearchPage.html'"> User Search</button>
            
    
            <div class = "pushRight">
                <button OnClick = "location.href = 'MovieListPage.html'"> Movies</button>
                <button OnClick = "location.href = 'SeriesListPage.html'"> Series</button>
                <script>
                    
                    var currentUser = sessionStorage.getItem("user");
                    console.log(currentUser);
    
                    function signout(){
                        sessionStorage.removeItem("user");
                        sessionStorage.removeItem("userID");
                        location.reload();
                    }
                    
                    if(currentUser == null){
                        
                        
                        document.write(`<button OnClick = "location.href = 'LoginPage.html'"> Login/Signup</button>`);
                        document.write(`<button OnClick = "location.href = 'LoginPage.html'"> Guest </button>`);
                        
                        
                    }
                    else{
                        document.write(`<button OnClick = "signout()"> Signout</button>`);
                        document.write(`<button OnClick = "location.href = 'ProfilePage.html'"> ${currentUser}</button>`);
                    }
                    
                </script>
                
            </div>
    
        </section>

        <h1>Series Search</h1>
        <!-- FORM FOR MOVIE INPUT -->
        <form id="series-search" action="/series-search">
            <label for="series-name">Series Name:</label>
            <input type="text" id="series-name" name="series-name"><br>
            <label for="series-year">Year:</label>
            <input type="text" id="series-year" name="series-year"><br>
            <div id = "noSeriesFound"> </div>
            <button type="submit">Submit Info</button>
        </form>

        
        
        <!-- SENDING INFO FROM FORM AS JSON TO SERVER -->
        <script>

            

            const form = document.getElementById('series-search');

            form.addEventListener('submit', (event) => {
                console.log("Pressed");
                // Prevents issues
                event.preventDefault();

                let data = new FormData(form);
                console.log(data);
                let seriesInfo = {};
                data.forEach((value, key) => {seriesInfo[key] = value});
                console.log(seriesInfo);
                // Fetches series info from main server
                
                fetch('/series-search', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(seriesInfo)
                })
                .then(response => {
                    console.log(response);
                    return response.text();
                })
                .then(text => {
                    if(text !== 'undefined'){
                        let jsonData = JSON.parse(text);
                        
                        sessionStorage.setItem("series", JSON.stringify(jsonData));
                        console.log(sessionStorage.getItem("series"));
                        document.location.href = "SeriesPage.html";
                    }
                    else{
                        console.log('Entry does not exist');
                        let str = "<h2>No series found matching this criteria</h2>";
                        document.getElementById('noSeriesFound').innerHTML = str;
                    }
                })
                .catch(error => {
                    console.log("No series found");
                    console.log(error);
                });
                
            });
        </script>

        
        
    </body>
</html>