<!DOCTYPE html>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<html>	




<head>

    <title>FILMINDER</title>
    <meta charset = "UTF-8">
    <meta name = "FILMINDER" content = "This is the main title page for FILMINDER">
    <link rel="stylesheet" href="./style/style.css"/>
    <script type = "text/javascript" src = "PopulateTable.js"></script>
    
            
</head>


<body>
    
    <section class = "TopBar">
        
        <button OnClick = "location.href = 'Website.html'">FILMINDER</button> 

        
        <form id="searchbar">
            
            <input type="text" id = "searchText" placeholder="Enter the search type|followed by the search, e.g. movie|Shrek" name="search">
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>

        <!-- SENDING INFO FROM FORM AS JSON TO SERVER -->
        <script>
            console.log("hello1");
            const form = document.getElementById('searchbar');
            console.log(form);
            form.addEventListener('submit', (event) => {
                // Prevents issues, can't remember what issues though
                event.preventDefault();

                let data = new FormData(form);
                console.log(data);
                let str = document.getElementById("searchText").value;
                //let str = data.get("search");
                console.log(str);
                if(str.startsWith('Movie|')){

                
                    let movieInfo = {};
                    movieInfo['movie-name'] = str.split("|")[1];

                    // Fetches movie info from main server
                    // Need to revamp for dynamic web pages
                    fetch('/movie-search', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(movieInfo)
                    })
                    .then(response => response.text())
                    //.then(text => console.log(JSON.parse(text)))
                    .then(text => {
                        let jsonData = JSON.parse(text);
                        console.log(jsonData);
                        sessionStorage.setItem("searchResults", JSON.stringify(jsonData));
                        
                        console.log(sessionStorage.getItem("searchResults"));
                        document.location.href = "SearchResultsPage.html";
                    })
                    .catch(error => console.log(error));
                }

            });
        </script>

        <div class = "alignCenter">
            
            
            
        </div>

        <div class = "pushRight">
            <button OnClick = "location.href = 'MovieListPage.html'"> Movies</button> 
            <button OnClick = "location.href = 'SeriesListPage.html'"> Series</button> 
            <button OnClick = "location.href = 'ActorsListPage.html'"> Actors</button>
            
            <script>
                var currentUser = sessionStorage.getItem("user");
                console.log(currentUser);
                
                if(currentUser == null){
                    
                    
                    document.write(`<button OnClick = "location.href = 'LoginPage.html'"> Login/Signup</button>`);
                    document.write(`<button OnClick = "location.href = 'LoginPage.html'"> Guest </button>`);
                    
                    
                }
                else{
                    document.write(`<button OnClick = "location.href = 'ProfilePage.html'"> ${currentUser}</button>`);
                }
                
                
                
                
            </script>
            
        </div>
        

        
    </section>
    


    <h1>
        
        
        <div>
            <img id = "filminderLogo" src = "FilminderLogoTransparent.png" alt = "This is our logo" height = "250" width = "250">
            
        </div>

    </h1>

    <div id = "WhatsHot">
        <h2><strong>What's Hot</strong></h2>

        <div class = "tableHeader">

            <strong class = "subheader">Hot Movies</strong>
             
        </div>
        
        <a class = "pushRight" href = 'MovieListPage.html'>Browse Movie List</a>

        <table id = "HotMovies">
            <script> populateTable("MovieObject.json", "HotMovies", "MoviePage.html", "movie")</script>
        </table>
        
        
        <div class = "tableHeader">
            <strong class = "subheader">Hot Series</strong>
                
            
            
        </div>
        <a class = "pushRight" href = "https://en.wikipedia.org/wiki/Shrek">Browse Series List</a>

        <table id = "HotSeries">
            <script> populateTable("MovieObject.json", "HotSeries", "SeriesPage.html", "movie")</script>
        </table>
        
        <div class = "tableHeader">
            <strong class = "subheader">Hot Actors</strong>
                
            
            
        </div>
        <a class = "pushRight" href = "https://en.wikipedia.org/wiki/Shrek">Browse Actors List</a>

        <table id = "HotActors">
            <script> populateTable("MovieObject.json", "HotActors", "ActorPage.html", "actor")</script>
        </table>
        

    </div>
    

    <link rel="stylesheet" href="./style/style.css"/>
    
    
    
</body>



</html>





